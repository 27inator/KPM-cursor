#!/usr/bin/expect -f

set timeout 60
set kaspa_cli "../rusty-kaspa/target/release/kaspa-cli"

log_user 1

puts "ğŸ”’ GENERATING ISOLATED COMPANY WALLETS"
puts "======================================"
puts "Each company gets COMPLETELY SEPARATE mnemonic"
puts "NO SHARED TRUST - FULL SECURITY ISOLATION"
puts ""

# Confirmed real master wallet
puts "âœ… Using CONFIRMED real master wallet:"
puts "   kaspatest:qpxm5tpyg8p6z7f6hy9mtlwz2es03cqtavaldsctcdltmnz6yfz6gvurgpmem"
puts ""

set companies {"fresh-test-company" "explorer-test-company" "acme-manufacturing" "luxury-jewelers-inc"}
set wallet_data ""

foreach company $companies {
    puts "ğŸ¢ Generating wallet for: $company"
    puts "   Creating UNIQUE mnemonic..."
    
    # Start kaspa-cli for this company
    spawn $kaspa_cli
    expect "$ "
    
    # Generate new wallet with unique mnemonic
    send "wallet create --testnet-10\r"
    
    # Capture the mnemonic
    expect {
        -re "Mnemonic phrase: (.+)" {
            set mnemonic [string trim $expect_out(1,string)]
            puts "   ğŸ“ Mnemonic captured"
        }
        timeout {
            puts "   âŒ Failed to capture mnemonic"
            continue
        }
    }
    
    # Skip phishing hint
    expect "Create phishing hint" {
        send "\r"
    }
    
    expect "$ "
    
    # Get the address
    send "wallet address --testnet-10\r"
    expect {
        -re "(kaspatest:\[a-z0-9\]+)" {
            set address $expect_out(1,string)
            puts "   ğŸ“ Address: $address"
        }
        timeout {
            puts "   âŒ Failed to capture address"
            send "exit\r"
            expect eof
            continue
        }
    }
    
    expect "$ "
    send "exit\r"
    expect eof
    
    # Save wallet data
    append wallet_data "$company|$address|$mnemonic\n"
    
    puts "   âœ… $company wallet created"
    puts "   ğŸŒ Explorer: https://explorer-tn10.kaspa.org/addresses/$address"
    puts ""
    
    # Brief pause between wallet creations
    sleep 1
}

# Save all wallet data securely
set fp [open "isolated_company_wallets.txt" w]
puts $fp "ISOLATED COMPANY WALLETS"
puts $fp "========================"
puts $fp "Master Wallet: kaspatest:qpxm5tpyg8p6z7f6hy9mtlwz2es03cqtavaldsctcdltmnz6yfz6gvurgpmem"
puts $fp "Master Mnemonic: arrest acid fall interest comfort expire aunt combine actor tackle stove coral"
puts $fp ""
puts $fp "COMPANY WALLETS (Each with UNIQUE mnemonic):"
puts $fp "============================================="
puts $fp $wallet_data
close $fp

puts "ğŸ’¾ All wallet data saved to isolated_company_wallets.txt"
puts ""
puts "ğŸ”’ SECURITY ACHIEVED:"
puts "   âœ… Master wallet: CONFIRMED REAL"
puts "   âœ… Company wallets: COMPLETELY ISOLATED"
puts "   âœ… Each company: UNIQUE mnemonic"
puts "   âœ… No shared trust points"
puts ""
puts "ğŸš€ Next: Test master â†’ company transactions" 