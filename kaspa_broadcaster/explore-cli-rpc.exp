#!/usr/bin/expect -f

set timeout 30
set kaspa_cli "../rusty-kaspa/target/release/kaspa-cli"

log_user 1

puts "ğŸ” EXPLORING KASPA-CLI RPC FOR OP_RETURN TRANSACTIONS"
puts "==================================================="

spawn $kaspa_cli
expect "$ "

puts "ğŸ”Œ Connecting to local node..."
send "server 127.0.0.1:17210\r"
expect "$ "

send "connect\r"
expect {
    "Connected" {
        puts "âœ… Connected!"
    }
    "Error" {
        puts "âŒ Connection failed"
        exit 1
    }
}
expect "$ "

puts ""
puts "ğŸ” EXPLORING RPC COMMANDS..."
puts "============================"

# Check RPC help
puts "Checking RPC help..."
send "help rpc\r"
expect "$ "

puts ""
puts "Trying 'rpc' command directly..."
send "rpc\r"
expect "$ "

puts ""
puts "Checking if we can call RPC methods..."
send "rpc help\r"
expect "$ "

puts ""
puts "Trying to call getInfo via RPC..."
send "rpc getInfo\r"
expect "$ "

puts ""
puts "ğŸ§ª TESTING TRANSACTION CREATION METHODS..."
puts "=========================================="

# Check for transaction creation methods
puts "Looking for transaction creation methods..."
send "rpc getBlockTemplate\r"
expect "$ "

puts ""
puts "Trying createRawTransaction..."
send "rpc createRawTransaction\r"
expect "$ "

puts ""
puts "Trying submitTransaction..."
send "rpc submitTransaction\r"
expect "$ "

puts ""
puts "ğŸ” EXPLORING ALL RPC METHODS..."
puts "==============================="

# Get list of available RPC methods
puts "Getting RPC method list..."
send "rpc\r"
expect "$ "

puts ""
puts "ğŸ“‹ RPC EXPLORATION COMPLETE"
puts "==========================="

send "exit\r"
expect eof

puts "âœ… CLI RPC exploration finished" 